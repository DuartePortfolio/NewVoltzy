{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport { getToken } from \"../backend/token\";\nimport { housesService } from \"../services/housesService\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar AppContext = createContext(undefined);\nexport var AppProvider = function AppProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    user = _useState2[0],\n    setUser = _useState2[1];\n  var _useState3 = useState(null),\n    _useState4 = _slicedToArray(_useState3, 2),\n    currentHouse = _useState4[0],\n    setCurrentHouse = _useState4[1];\n  var _useState5 = useState([]),\n    _useState6 = _slicedToArray(_useState5, 2),\n    houses = _useState6[0],\n    setHouses = _useState6[1];\n  var _useState7 = useState(true),\n    _useState8 = _slicedToArray(_useState7, 2),\n    isLoading = _useState8[0],\n    setIsLoading = _useState8[1];\n  var isAuthenticated = user !== null;\n  var refreshHouses = function () {\n    var _ref2 = _asyncToGenerator(function* () {\n      if (!user) return;\n      try {\n        var fetchedHouses = yield housesService.getHouses();\n        setHouses(fetchedHouses);\n        if (fetchedHouses.length > 0 && !currentHouse) {\n          setCurrentHouse(fetchedHouses[0]);\n        }\n      } catch (error) {\n        console.error('Failed to fetch houses:', error);\n      }\n    });\n    return function refreshHouses() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  useEffect(function () {\n    var checkAuth = function () {\n      var _ref3 = _asyncToGenerator(function* () {\n        try {\n          var token = yield getToken();\n          if (token) {\n            setIsLoading(false);\n          } else {\n            setIsLoading(false);\n          }\n        } catch (error) {\n          console.error('Auth check failed:', error);\n          setIsLoading(false);\n        }\n      });\n      return function checkAuth() {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n    checkAuth();\n  }, []);\n  useEffect(function () {\n    if (user) {\n      refreshHouses();\n    }\n  }, [user]);\n  var value = {\n    user: user,\n    setUser: setUser,\n    currentHouse: currentHouse,\n    setCurrentHouse: setCurrentHouse,\n    houses: houses,\n    setHouses: setHouses,\n    isAuthenticated: isAuthenticated,\n    isLoading: isLoading,\n    refreshHouses: refreshHouses\n  };\n  return _jsx(AppContext.Provider, {\n    value: value,\n    children: children\n  });\n};\nexport var useApp = function useApp() {\n  var context = useContext(AppContext);\n  if (context === undefined) {\n    throw new Error('useApp must be used within an AppProvider');\n  }\n  return context;\n};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","getToken","housesService","jsx","_jsx","AppContext","undefined","AppProvider","_ref","children","_useState","_useState2","_slicedToArray","user","setUser","_useState3","_useState4","currentHouse","setCurrentHouse","_useState5","_useState6","houses","setHouses","_useState7","_useState8","isLoading","setIsLoading","isAuthenticated","refreshHouses","_ref2","_asyncToGenerator","fetchedHouses","getHouses","length","error","console","apply","arguments","checkAuth","_ref3","token","value","Provider","useApp","context","Error"],"sources":["C:/Users/Seele/Documents/ESMAD/Computação Móvel e Ubíqua/New Voltzy/NewVoltzy/src/contexts/AppContext.tsx"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect, ReactNode } from 'react';\r\nimport { getToken } from '../backend/token';\r\nimport { housesService, House } from '../services/housesService';\r\n\r\ninterface User {\r\n  id: number;\r\n  name: string;\r\n  email: string;\r\n  profile_picture_url?: string;\r\n}\r\n\r\ninterface AppContextType {\r\n  user: User | null;\r\n  setUser: (user: User | null) => void;\r\n  currentHouse: House | null;\r\n  setCurrentHouse: (house: House | null) => void;\r\n  houses: House[];\r\n  setHouses: (houses: House[]) => void;\r\n  isAuthenticated: boolean;\r\n  isLoading: boolean;\r\n  refreshHouses: () => Promise<void>;\r\n}\r\n\r\nconst AppContext = createContext<AppContextType | undefined>(undefined);\r\n\r\ninterface AppProviderProps {\r\n  children: ReactNode;\r\n}\r\n\r\nexport const AppProvider: React.FC<AppProviderProps> = ({ children }) => {\r\n  const [user, setUser] = useState<User | null>(null);\r\n  const [currentHouse, setCurrentHouse] = useState<House | null>(null);\r\n  const [houses, setHouses] = useState<House[]>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  const isAuthenticated = user !== null;\r\n\r\n  // Load houses when user is authenticated\r\n  const refreshHouses = async () => {\r\n    if (!user) return;\r\n\r\n    try {\r\n      const fetchedHouses = await housesService.getHouses();\r\n      setHouses(fetchedHouses);\r\n\r\n      // Set first house as current if none selected\r\n      if (fetchedHouses.length > 0 && !currentHouse) {\r\n        setCurrentHouse(fetchedHouses[0]);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to fetch houses:', error);\r\n    }\r\n  };\r\n\r\n  // Check authentication on mount\r\n  useEffect(() => {\r\n    const checkAuth = async () => {\r\n      try {\r\n        const token = await getToken();\r\n        if (token) {\r\n          // You might want to validate the token with the backend here\r\n          // For now, we'll assume it's valid\r\n          // In a real app, you'd fetch the user profile\r\n          setIsLoading(false);\r\n        } else {\r\n          setIsLoading(false);\r\n        }\r\n      } catch (error) {\r\n        console.error('Auth check failed:', error);\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    checkAuth();\r\n  }, []);\r\n\r\n  // Fetch houses when user changes\r\n  useEffect(() => {\r\n    if (user) {\r\n      refreshHouses();\r\n    }\r\n  }, [user]);\r\n\r\n  const value: AppContextType = {\r\n    user,\r\n    setUser,\r\n    currentHouse,\r\n    setCurrentHouse,\r\n    houses,\r\n    setHouses,\r\n    isAuthenticated,\r\n    isLoading,\r\n    refreshHouses,\r\n  };\r\n\r\n  return <AppContext.Provider value={value}>{children}</AppContext.Provider>;\r\n};\r\n\r\nexport const useApp = (): AppContextType => {\r\n  const context = useContext(AppContext);\r\n  if (context === undefined) {\r\n    throw new Error('useApp must be used within an AppProvider');\r\n  }\r\n  return context;\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}